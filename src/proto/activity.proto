syntax = "proto3";

package fitglue;

option go_package = "fitglue/pkg/shared/pb";

import "standardized_activity.proto";

// ActivitySource enum defines where the data originated.
enum ActivitySource {
  SOURCE_UNKNOWN = 0;
  SOURCE_HEVY = 1;
  SOURCE_FITBIT = 3;
  SOURCE_TEST = 99;
}

// ActivityPayload is the unified message format published to Pub/Sub.
message ActivityPayload {
  ActivitySource source = 1;
  string user_id = 2;      // Internal FitGlue User ID
  string timestamp = 3;    // ISO 8601 Timestamp of activity start
  string original_payload_json = 4; // Raw JSON payload stringified (flexible but preserved)
  map<string, string> metadata = 5; // Extra tracing context
  StandardizedActivity standardized_activity = 6;
}

// EnrichedActivityEvent is the message format for topic-enriched-activity.
// EnrichedActivityEvent is the message format for topic-enriched-activity.
message EnrichedActivityEvent {
  // Identity
  string user_id = 1;
  string activity_id = 2;  // Unique ID for the processed activity
  ActivitySource source = 3;

  // Core Metadata (Extracted for easy downstream access)
  string activity_type = 4; // e.g. WEIGHT_TRAINING
  string description = 5;   // The final description (original or generated)
  string name = 6;          // Activity Title

  // Full Data
  StandardizedActivity activity_data = 7;

  // Generated Artifacts
  string fit_file_uri = 8;      // Path to the generated FIT file (gs://...)

  // Enrichment Metadata
  repeated string applied_enrichments = 9; // List of enrichers that ran
  map<string, string> enrichment_metadata = 10; // Extra stats
  // Routing information determined by the pipeline
  repeated string destinations = 11;
  string pipeline_id = 12;
}
