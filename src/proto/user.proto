syntax = "proto3";
package fitglue;

import "google/protobuf/timestamp.proto";

option go_package = "fitglue/pkg/shared/pb";

message UserRecord {
  string user_id = 1;
  google.protobuf.Timestamp created_at = 2;
  UserIntegrations integrations = 3;
  // Pipelines define the data flow: Source -> Enrichers -> Routing
  repeated PipelineConfig pipelines = 4;
}

message PipelineConfig {
  string id = 1; // Unique ID (uuid) for tracing
  string source = 2; // e.g. "SOURCE_HEVY"
  repeated EnricherConfig enrichers = 3;
  repeated string destinations = 4; // e.g. ["strava", "gcs"]
}

message UserIntegrations {
  HevyIntegration hevy = 1;
  FitbitIntegration fitbit = 2;
  StravaIntegration strava = 3;
}


message HevyIntegration {
  bool enabled = 1;
  string api_key = 2;
  string user_id = 3;
}

message FitbitIntegration {
    bool enabled = 1;
    string access_token = 2;
    string refresh_token = 3;
    google.protobuf.Timestamp expires_at = 4;
    string fitbit_user_id = 5;
}

message SourceEnrichmentConfig {
  repeated EnricherConfig enrichers = 1;
}

message EnricherConfig {
  // Use strictly typed provider enum instead of string name
  EnricherProviderType provider_type = 1;
  map<string, string> inputs = 2;
}

enum EnricherProviderType {
  ENRICHER_PROVIDER_UNSPECIFIED = 0;
  ENRICHER_PROVIDER_FITBIT_HEART_RATE = 1;
  ENRICHER_PROVIDER_WORKOUT_SUMMARY = 2;
  ENRICHER_PROVIDER_MUSCLE_HEATMAP = 3;
  ENRICHER_PROVIDER_SOURCE_LINK = 4;
  ENRICHER_PROVIDER_METADATA_PASSTHROUGH = 5;
  ENRICHER_PROVIDER_VIRTUAL_GPS = 6;
  ENRICHER_PROVIDER_MOCK = 99;
}

message StravaIntegration {
    bool enabled = 1;
    string access_token = 2;
    string refresh_token = 3;
    google.protobuf.Timestamp expires_at = 4;
    int64 athlete_id = 5;
}

