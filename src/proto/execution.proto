syntax = "proto3";

package fitglue;

import "google/protobuf/timestamp.proto";

option go_package = "fitglue/pkg/shared/pb";

// ExecutionRecord represents a function execution in Firestore
message ExecutionRecord {
  string execution_id = 1;  // Required: unique identifier
  string service = 2;        // Required: which function executed
  ExecutionStatus status = 3; // Required: current status
  google.protobuf.Timestamp timestamp = 4; // Required: when it started
  string trigger_type = 7;   // Required: how it was triggered

  // Optional context fields
  optional string user_id = 5;
  optional string test_run_id = 6;  // For test cleanup

  // Optional timing
  optional google.protobuf.Timestamp start_time = 8;
  optional google.protobuf.Timestamp end_time = 9;

  // Optional results
  optional string error_message = 10;
  optional string inputs_json = 11;   // JSON-encoded inputs
  optional string outputs_json = 12;  // JSON-encoded outputs
  optional google.protobuf.Timestamp expire_at = 14; // When this record should be deleted

  // Optional parent-child execution tracking
  optional string parent_execution_id = 13;  // Links child executions to parent
}

enum ExecutionStatus {
  STATUS_UNKNOWN = 0;
  STATUS_STARTED = 1;
  STATUS_SUCCESS = 2;
  STATUS_FAILED = 3;
  STATUS_PENDING = 4;
  STATUS_WAITING = 5;
}
